<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LFG Site</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* Basic reset and body styling */
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #fff;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Center content and add padding */
        #mainContent, #profileContent {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 8px;
        }

        /* Style for headings */
        h1, h2 {
            text-align: center;
            margin: 0;
        }

        /* Auth form styling */
        .auth-form {
            background: rgba(0, 0, 0, 0.8);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            margin: 20px auto;
            width: 300px; /* Set a fixed width for consistency */
        }

        .auth-form h2 {
            margin-bottom: 10px;
        }

        .auth-form input {
            display: block;
            margin: 10px 0;
            padding: 10px;
            width: calc(100% - 22px); /* Full width minus padding */
            border: 1px solid #444;
            border-radius: 4px;
            background: #222;
            color: #fff;
        }

        .auth-form button {
            padding: 10px;
            width: 100%;
            border: none;
            border-radius: 4px;
            background: #007bff;
            color: #fff;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .auth-form button:hover {
            background: #0056b3;
        }

        /* Profile styling */
        #profileContent {
            display: none;
        }

        #profileContent p {
            font-size: 18px;
        }

        /* Style for form elements */
        form {
            margin: 20px 0;
        }

        label {
            display: block;
            margin: 10px 0 5px;
        }

        select, button {
            margin: 5px 0;
            padding: 10px;
            width: 100%;
            border: 1px solid #444;
            border-radius: 4px;
            background: #222;
            color: #fff;
        }

        select:focus, button:focus {
            outline: none;
            box-shadow: 0 0 5px #007bff;
        }

        button:hover {
            background: #0056b3;
        }

        /* Card style for group items */
        #groupList {
            margin-top: 20px;
        }

        .group-item {
            border: 1px solid #444;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, background 0.3s ease;
        }

        .group-item:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.02);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            #mainContent, #profileContent {
                padding: 10px;
            }

            .auth-form, form, #groupList {
                padding: 10px;
                width: 100%; /* Full width on smaller screens */
                max-width: none; /* Remove max-width constraint */
            }

            .auth-form input, .auth-form button, select, button {
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <h1>Titan LFG</h1>

    <!-- Authentication Forms -->
    <div class="auth-form" id="authForm">
        <h2>Register</h2>
        <input type="email" id="registerEmail" placeholder="Email" />
        <input type="password" id="registerPassword" placeholder="Password" />
        <input type="text" id="registerUsername" placeholder="Username" />
        <button onclick="register()">Register</button>
        
        <h2>Login</h2>
        <input type="email" id="loginEmail" placeholder="Email" />
        <input type="password" id="loginPassword" placeholder="Password" />
        <button onclick="login()">Login</button>
    </div>

    <!-- Main content for group creation -->
    <div id="mainContent" style="display: none;">
        <form id="lfgForm">
            <button type="button" onclick="createGroup()">Create Group</button>
            <button type="button" onclick="selectMission('Void Farming')">Void Farming</button>
            <button type="button" onclick="selectMission('Calling of the Descendants')">Calling of the Descendants</button>
            <button type="button" onclick="selectMission('Encrypted Vaults')">Encrypted Vaults</button>
            <button type="button" onclick="selectMission('Zone Farming')">Zone Farming</button>
            <button type="button" onclick="selectMission('Normal Void Battles')">Normal Void Battles</button>
            <button type="button" onclick="selectMission('Hard Void Battles')">Hard Void Battles</button>
            <button type="button" onclick="donate()">Donate</button>
            
            <label for="missionType">Select a Mission Type:</label>
            <select id="missionType" onchange="updateLevels()">
                <option value="Void Farming">Void Farming</option>
                <option value="Calling of the Descendants">Calling of the Descendants</option>
                <option value="Normal Void Battles">Normal Void Battles</option>
                <option value="Hard Void Battles">Hard Void Battles</option>
                <option value="Encrypted Vaults">Encrypted Vaults</option>
                <option value="Zone Farming">Zone Farming</option>
            </select>

            <label for="missionLevel">What is your Objective:</label>
            <select id="missionLevel">
                <!-- Levels will be populated here -->
            </select>
        </form>

        <!-- Recently created groups list -->
        <div id="groupList">
            <h2>Recently Created Groups</h2>
            <!-- Groups will be listed here -->
        </div>
    </div>

    <!-- Profile page -->
    <div id="profileContent">
        <h2>Profile</h2>
        <p id="usernameDisplay">Username: </p>
        <p id="emailDisplay">Email: </p>
        <button onclick="logout()">Logout</button>
    </div>

    <!-- Background music -->
    <audio id="backgroundMusic" autoplay loop>
        <source src="background-music.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, limit, doc, setDoc } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-firestore.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDkXMlEkORvvfH-kBYbBLAfasBoCsHCQmQ",
            authDomain: "titan1lfg.firebaseapp.com",
            projectId: "titan1lfg",
            storageBucket: "titan1lfg.appspot.com",
            messagingSenderId: "51631664886",
            appId: "1:51631664886:web:1f9660b9a81b3c945446d7",
            measurementId: "G-VG05N7CS55"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Function to handle registration
        window.register = async function() {
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            const username = document.getElementById('registerUsername').value;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Save the username in Firestore
                await setDoc(doc(db, 'users', user.uid), {
                    email: user.email,
                    username: username
                });

                alert('Registration successful!');
                document.getElementById('mainContent').style.display = 'block';
                document.getElementById('authForm').style.display = 'none';
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Function to handle login
        window.login = async function() {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;

                // Retrieve username from Firestore
                const userDoc = await doc(db, 'users', user.uid).get();
                const userData = userDoc.data();

                // Display username and email
                document.getElementById('usernameDisplay').textContent = `Username: ${userData.username}`;
                document.getElementById('emailDisplay').textContent = `Email: ${user.email}`;
                
                alert('Login successful!');
                document.getElementById('mainContent').style.display = 'block';
                document.getElementById('profileContent').style.display = 'block';
                document.getElementById('authForm').style.display = 'none';
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Function to log out
        window.logout = async function() {
            try {
                await signOut(auth);
                alert('Logged out successfully!');
                document.getElementById('authForm').style.display = 'block';
                document.getElementById('mainContent').style.display = 'none';
                document.getElementById('profileContent').style.display = 'none';
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Function to create a group
        window.createGroup = async function() {
            const missionType = document.getElementById('missionType').value;
            const missionLevel = document.getElementById('missionLevel').value;
            const user = auth.currentUser;
            if (user) {
                try {
                    await addDoc(collection(db, 'groups'), {
                        missionType: missionType,
                        missionLevel: missionLevel,
                        user: user.email,
                        createdAt: new Date()
                    });
                    alert('Group created successfully!');
                    displayGroups(); // Refresh the list of groups
                } catch (e) {
                    alert('Error adding group: ' + e.message);
                }
            } else {
                alert('You must be logged in to create a group.');
            }
        }

        // Function to display groups
        function displayGroups() {
            const q = query(collection(db, 'groups'), orderBy('createdAt', 'desc'), limit(10));
            onSnapshot(q, (snapshot) => {
                const groupList = document.getElementById('groupList');
                groupList.innerHTML = '<h2>Recently Created Groups</h2>'; // Clear previous entries
                snapshot.forEach((doc) => {
                    const groupData = doc.data();
                    const div = document.createElement('div');
                    div.className = 'group-item';
                    div.textContent = `Mission Type: ${groupData.missionType}, Objective: ${groupData.missionLevel}, Created By: ${groupData.user}`;
                    groupList.appendChild(div);
                });
            });
        }

        // Function to update mission levels based on selected mission type
        window.updateLevels = function() {
            const missionType = document.getElementById('missionType').value;
            const missionLevel = document.getElementById('missionLevel');
            missionLevel.innerHTML = ''; // Clear existing options

            if (levels[missionType]) {
                levels[missionType].forEach(level => {
                    const option = document.createElement('option');
                    option.value = level;
                    option.textContent = level;
                    missionLevel.appendChild(option);
                });
            }
        }

        // Object storing the different mission types and their respective levels
        const levels = {
            "Void Farming": ['Fire', 'Electric', 'Ice', 'Toxic', 'Non-Attribute'],
            "Calling of the Descendants": [
                'Bio-Lab', 'Caligo Ossuary', 'Heart of the Fortress', 'Magister Lab', 
                'Mystery\'s End', 'Old Mystery', 'Quarantine Zone', 'Seed Vault', 
                'Sepulcher', 'Slumber Valley', 'The Asylum', 'The Chapel', 
                'The Forgottense', 'The Haven', 'The Shelter', 'Unknown Laboratory'
            ],
            "Normal Void Battles": ['Grave Walker', 'Stunning Beauty', 'Executioner', 
                                     'Dead Bride', 'Devourer', 'Pyromaniac', 
                                     'Swamp Walker', 'Hanged Man'],
            "Hard Void Battles": ['Executioner', 'Dead Bride', 'Devourer', 'Pyromaniac', 
                                   'Swamp Walker', 'Obstructor', 'Frost Walker', 
                                   'Molten Fortress'],
            "Encrypted Vaults": ['Vault 1', 'Vault 2', 'Vault 3'], // Placeholder levels
            "Zone Farming": ['Agna Desert', 'Echo Swamp', 'Fortress', 'Haigos', 
                             'Kingston', 'Sterile Land', 'Vespers', 'White Night Gulch']
        };

        // Initialize the mission levels for the default selected mission type
        updateLevels();

        // Display groups on page load
        displayGroups();
    </script>
</body>
</html>
