<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Titan LFG</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        /* General Styles */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #121212; /* Dark background */
            color: #e0e0e0; /* Light text color */
        }
        h1 {
            text-align: center;
            margin-top: 20px;
            color: #1e90ff; /* Blue color */
        }
        /* Main Content Styles */
        #mainContent {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #1f1f1f; /* Dark background for main content */
            box-shadow: 0 0 10px rgba(0,0,0,0.3); /* Slightly darker shadow */
            border-radius: 5px;
            border: 1px solid #555; /* Grey border */
        }
        #groups {
            margin-top: 20px;
        }
        .group-item {
            padding: 10px;
            border-bottom: 1px solid #555; /* Grey border for group items */
        }
        .group-item:last-child {
            border-bottom: none;
        }
        /* Profile Page Styles */
        #profileContent {
            display: none; /* Hidden initially */
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background-color: #1f1f1f; /* Dark background for profile */
            box-shadow: 0 0 10px rgba(0,0,0,0.3); /* Slightly darker shadow */
            border-radius: 5px;
            border: 1px solid #555; /* Grey border */
        }
        /* Background Music */
        #backgroundMusic {
            display: none; /* Hidden in the UI */
        }
    </style>
</head>
<body>
    <h1>Titan LFG</h1>

    <!-- Main content for group creation -->
    <div id="mainContent">
        <form id="lfgForm">
            <label for="game">Game:</label>
            <input type="text" id="game" placeholder="Game Name" required />

            <label for="missionType">Mission Type:</label>
            <select id="missionType" onchange="updateLevels()">
                <option value="">Select Mission Type</option>
                <option value="Void Farming">Void Farming</option>
                <option value="Calling of the Descendants">Calling of the Descendants</option>
                <option value="Normal Void Battles">Normal Void Battles</option>
                <option value="Hard Void Battles">Hard Void Battles</option>
                <option value="Encrypted Vaults">Encrypted Vaults</option>
                <option value="Zone Farming">Zone Farming</option>
            </select>

            <label for="missionLevel">Mission Level:</label>
            <select id="missionLevel">
                <option value="">Select Mission Level</option>
            </select>

            <label for="description">Description:</label>
            <textarea id="description" placeholder="Description" required></textarea>

            <button type="submit">Create Group</button>
        </form>

        <!-- Recently created groups list -->
        <div id="groups">
            <h2>Recently Created Groups</h2>
            <!-- Groups will be listed here -->
        </div>
    </div>

    <!-- Profile page -->
    <div id="profileContent">
        <h2>Profile</h2>
        <p id="usernameDisplay"></p>
        <p id="emailDisplay"></p>
        <button type="button" onclick="logout()">Logout</button>
    </div>

    <!-- Background music -->
    <audio id="backgroundMusic" autoplay loop>
        <source src="background-music.mp3" type="audio/mpeg">
        Your browser does not support the audio element.
    </audio>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-app.js";
        import { getAuth, signOut } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, limit, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.6.6/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDkXMlEkORvvfH-kBYbBLAfasBoCsHCQmQ",
            authDomain: "titan1lfg.firebaseapp.com",
            projectId: "titan1lfg",
            storageBucket: "titan1lfg.appspot.com",
            messagingSenderId: "51631664886",
            appId: "1:51631664886:web:1f9660b9a81b3c945446d7",
            measurementId: "G-VG05N7CS55"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.logout = async function() {
            try {
                await signOut(auth);
                alert('Logged out successfully!');
                document.getElementById('profileContent').style.display = 'none';
                document.getElementById('mainContent').style.display = 'none';
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        const levels = {
            "Void Farming": ['Fire', 'Electric', 'Ice', 'Toxic', 'Non-Attribute'],
            "Calling of the Descendants": [
                'Bio-Lab', 'Caligo Ossuary', 'Heart of the Fortress', 'Magister Lab', 
                'Mystery\'s End', 'Old Mystery', 'Quarantine Zone', 'Seed Vault', 
                'Sepulcher', 'Slumber Valley', 'The Asylum', 'The Chapel', 
                'The Forgottense', 'The Haven', 'The Shelter', 'Unknown Laboratory'
            ],
            "Normal Void Battles": ['Grave Walker', 'Stunning Beauty', 'Executioner', 
                                     'Dead Bride', 'Devourer', 'Pyromaniac', 
                                     'Swamp Walker', 'Hanged Man'],
            "Hard Void Battles": ['Executioner', 'Dead Bride', 'Devourer', 'Pyromaniac', 
                                   'Swamp Walker', 'Obstructor', 'Frost Walker', 
                                   'Molten Fortress'],
            "Encrypted Vaults": ['Vault 1', 'Vault 2', 'Vault 3'], // Placeholder levels
            "Zone Farming": ['Agna Desert', 'Echo Swamp', 'Fortress', 'Haigos', 
                             'Kingston', 'Sterile Land', 'Vespers', 'White Night Gulch']
        };

        window.createGroup = async function() {
            const game = document.getElementById('game').value;
            const description = document.getElementById('description').value;
            const user = auth.currentUser;

            if (user) {
                try {
                    await addDoc(collection(db, 'lfgGroups'), {
                        game: game,
                        description: description,
                        user: user.email,
                        createdAt: new Date()
                    });
                    alert('Group created successfully!');
                    document.getElementById('lfgForm').reset();
                } catch (e) {
                    alert('Error adding group: ' + e.message);
                }
            } else {
                alert('You must be logged in to create a group.');
            }
        }

        const levels = {
            'Void Farming': ['Fire', 'Ice', 'Electric', 'Void'],
            'Calling of the Descendants': [
                'Bio-Lab', 'Caligo Ossuary', 'Heart of the Fortress', 'Magister Lab', 
                'Mystery\'s End', 'Old Mystery', 'Quarantine Zone', 'Seed Vault', 
                'Sepulcher', 'Slumber Valley', 'The Asylum', 'The Chapel', 
                'The Forgottense', 'The Haven', 'The Shelter', 'Unknown Laboratory'
            ],
            'Normal Void Battles': ['Grave Walker', 'Stunning Beauty', 'Executioner', 
                                     'Dead Bride', 'Devourer', 'Pyromaniac', 
                                     'Swamp Walker', 'Hanged Man'],
            'Hard Void Battles': ['Executioner', 'Dead Bride', 'Devourer', 'Pyromaniac', 
                                   'Swamp Walker', 'Obstructor', 'Frost Walker', 
                                   'Molten Fortress'],
            'Encrypted Vaults': ['Vault 1', 'Vault 2', 'Vault 3'],
            'Zone Farming': ['Agna Desert', 'Echo Swamp', 'Fortress', 'Haigos', 
                             'Kingston', 'Sterile Land', 'Vespers', 'White Night Gulch']
        };

        function updateLevels() {
            const missionType = document.getElementById('missionType').value;
            const missionLevel = document.getElementById('missionLevel');
            missionLevel.innerHTML = '<option value="">Select Mission Level</option>'; // Reset dropdown

            if (levels[missionType]) {
                levels[missionType].forEach(level => {
                    const option = document.createElement('option');
                    option.value = level;
                    option.textContent = level;
                    missionLevel.appendChild(option);
                });
            }
        }

        function displayLFGGroups() {
            const q = query(collection(db, 'lfgGroups'), orderBy('createdAt', 'desc'), limit(10));
            onSnapshot(q, (snapshot) => {
                const groupList = document.getElementById('groups');
                groupList.innerHTML = '<h2>Recently Created Groups</h2>';
                snapshot.forEach((doc) => {
                    const groupData = doc.data();
                    const div = document.createElement('div');
                    div.className = 'group-item';
                    div.innerHTML = `<h2>${groupData.game}</h2><p>${groupData.description}</p>`;
                    groupList.appendChild(div);
                });
            });
        }

        window.onload = function() {
            displayLFGGroups();
        };

        document.getElementById('lfgForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            await window.createGroup();
            displayLFGGroups(); // Refresh the list after creating a group
        });
    </script>
</body>
</html>
